<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Blackjack Dealer Demo</title>
<style>
  :root{
    /* THEME (easy to tweak) */
    --felt:#0f6a42;
    --felt-dark:#0b5434;
    --table-edge:#7b5a36;
    --chip-red:#d34a4a;
    --chip-blue:#3b7bd6;
    --chip-green:#2da66a;
    --chip-gold:#c9a227;
    --card-bg:#fff;
    --card-face:#111;
    --glow:rgba(255,255,255,.35);
  }

  *{box-sizing:border-box}
  body{
    margin:0;
    min-height:100svh;
    display:grid;
    place-items:center;
    background:radial-gradient(1200px 600px at 50% 30%, #0d3223 0%, #062218 60%, #03150f 100%);
    font-family:system-ui,Segoe UI,Inter,Arial,Helvetica,sans-serif;
    color:#eee;
  }

  /* Table with perspective (Stretch: 3D) */
  .table-wrap{
    width:min(1100px, 96vw);
    aspect-ratio:16/9;
    perspective: 1200px;
  }
  .table{
    position:relative;
    width:100%;
    height:100%;
    background: radial-gradient(ellipse at center, var(--felt) 0%, var(--felt-dark) 65%, #03170f 100%);
    border: 16px solid var(--table-edge);
    border-radius: 36px;
    box-shadow:
      inset 0 0 0 6px #00000040,
      0 40px 120px #000000aa;
    transform: rotateX(12deg);
    overflow:visible;
  }

  /* Spots */
  .spot{
    position:absolute;
    width: 280px;
    height: 160px;
    border: 2px dashed #ffffff22;
    border-radius: 18px;
    display:flex;align-items:center;justify-content:center;
    gap:12px;
  }
  .spot h3{
    position:absolute; top:-28px; font-weight:600; font-size:14px; opacity:.85
  }

  /* Layout */
  .spot.dealer{ left:50%; transform:translateX(-50%); top:8%;}
  .spot.player{ left:50%; transform:translateX(-50%); bottom:8%;}

  /* Deck + discard */
  .piles{
    position:absolute; right:24px; top:24px; width:140px; height:200px;
    display:flex; flex-direction:column; gap:12px; align-items:center;
  }
  .pile{
    position:relative; width:120px; height:160px;
    border-radius:12px; border: 2px solid #00000020;
    background:#00000020;
  }
  .pile h4{margin:0 0 6px 0; font-size:12px; text-align:center; opacity:.8}
  .stack{
    position:absolute; inset:0; border-radius:12px;
  }

  /* Card visuals */
  .card{
    position:absolute;
    width:80px; height:120px;
    background:var(--card-bg);
    border:1px solid #00000022;
    border-radius:10px;
    box-shadow: 0 8px 18px #0008;
    display:grid; place-items:center;
    color:var(--card-face);
    font-weight:700;
    user-select:none;
    transform-style:preserve-3d;
    backface-visibility:hidden;
  }
  /* Subtle 3D tilt */
  .card.face{ transform: rotateY(-10deg); }
  /* Hover peek (Stretch) — player cards lift slightly */
  .spot.player .card:hover{
    transform: translateY(-8px) rotateY(30deg);
  }

  .rank{
    font-size:20px; position:absolute; top:6px; left:8px;
  }
  .suit{
    font-size:22px; position:absolute; bottom:6px; right:8px;
  }

  /* Suits coloring */
  .s-red{ color:#c52a2a }
  .s-black{ color:#222 }

  /* Initial deck stack */
  .deck .card{
    left:20px; top:20px;
    transform: translate(0, 0) rotate(0deg) rotateY(-8deg);
  }
  .deck .card:nth-child(n){
    box-shadow: 0 6px 10px #0007;
  }

  /* Shuffle fan animation (Core) */
  @keyframes fan{
    0%{ transform: translate(0,0) rotate(0deg) }
    40%{ transform: translate(0,0) rotate(var(--r)) }
    60%{ transform: translate(0,0) rotate(calc(var(--r) * -1)) }
    100%{ transform: translate(0,0) rotate(0deg) }
  }
  .shuffling .card{
    animation: fan 800ms ease-in-out both;
  }
  /* Add per-card custom property for varied fan angles */
  .deck .card{ --r: 12deg; }
  .deck .card:nth-child(3n){ --r: 16deg; }
  .deck .card:nth-child(4n){ --r: 10deg; }

  /* Deal slide (Core) */
  @keyframes deal{
    0% { transform: translate(var(--sx), var(--sy)) rotateY(-8deg); opacity:0 }
    12% { opacity:1 }
    100% { transform: translate(var(--dx), var(--dy)) rotateY(var(--ry)); opacity:1 }
  }
  .dealing .fly{
    animation: deal 650ms cubic-bezier(.18,.68,.2,1) both;
    animation-delay: var(--delay, 0ms);
  }

  /* Burn card slide off deck (Stretch) */
  @keyframes burn{
    0% { transform: translate(0,0) rotate(0deg); opacity:1 }
    60% { transform: translate(-160px, 40px) rotate(-24deg); opacity:.9 }
    100%{ transform: translate(-260px, 60px) rotate(-36deg); opacity:0 }
  }
  .burning{
    animation: burn 500ms ease-out both;
  }

  /* Chip styles + hover glow (Core) */
  .chiptray{
    position:absolute; left:24px; top:24px; display:flex; gap:12px; align-items:center;
  }
  .chip{
    width:56px; height:56px; border-radius:50%;
    display:grid; place-items:center; font-weight:800; font-size:14px;
    box-shadow: 0 4px 12px #0008, inset 0 0 0 4px #fff8, inset 0 0 0 8px #00000012;
    transition: transform .14s ease, box-shadow .14s ease;
    cursor:pointer;
  }
  .chip:hover{
    transform: scale(1.08);
    box-shadow: 0 0 24px 6px var(--glow), inset 0 0 0 4px #fff8, inset 0 0 0 8px #00000012;
  }
  .chip.red{ background: var(--chip-red); }
  .chip.blue{ background: var(--chip-blue); }
  .chip.green{ background: var(--chip-green); }
  .chip.gold{ background: var(--chip-gold); color:#1a1300 }

  /* Placed chips area + badge */
  .bet-area{
    position:absolute;
    left:50%; transform: translateX(-50%);
    bottom: 42%;
    width: 180px; height: 100px;
    pointer-events:none;
  }
  .bet-chip{
    position:absolute; width:44px; height:44px; border-radius:50%;
    display:grid; place-items:center; font-weight:800; font-size:12px;
    box-shadow: 0 4px 12px #0008, inset 0 0 0 4px #fff8, inset 0 0 0 8px #00000012;
    transform: translate(0,0);
    pointer-events:auto;
  }
  .bet-badge{
    position:absolute; left:50%; transform:translateX(-50%);
    bottom:-24px;
    background:#00000060; border:1px solid #ffffff2a;
    padding:4px 10px; border-radius:999px; font-size:12px; letter-spacing:.2px;
    backdrop-filter: blur(4px);
  }

  /* Controls */
  .controls{
    position:absolute; left:24px; bottom:24px; display:flex; gap:10px; flex-wrap:wrap;
  }
  button{
    padding:10px 14px; border-radius:12px; border:1px solid #ffffff25;
    background:#ffffff12; color:#fff; font-weight:600; letter-spacing:.3px;
    backdrop-filter: blur(6px);
    cursor:pointer;
    transition: transform .08s ease, background .2s ease, box-shadow .2s ease;
  }
  button:hover{ transform: translateY(-1px); background:#ffffff18; box-shadow: 0 10px 30px #0006 }
  button:active{ transform: translateY(1px) scale(.99) }

  /* Hand zones for placed cards */
  .hand{
    position:absolute; 
	inset:0; 
	pointer-events:none;
  }
  .hand .card{
    pointer-events:auto; /* enable hover peek on player cards */
  }

  /* Subtle labels */
  .note{
    position:absolute; right:24px; bottom:24px; font-size:12px; opacity:.75
  }
</style>
</head>
<body>
  <div class="table-wrap">
    <div class="table" id="table">
      <!-- Chip tray (Core: hover glow/scale) -->
      <div class="chiptray">
        <div class="chip red"   data-val="5">$5</div>
        <div class="chip blue"  data-val="10">$10</div>
        <div class="chip green" data-val="25">$25</div>
        <div class="chip gold"  data-val="100">$100</div>
      </div>

      <!-- Dealer / Player spots -->
      <div class="spot dealer"><h3>Dealer</h3><div class="hand" id="dealerHand"></div></div>
      <div class="spot player">
        <h3>Player</h3>
        <div class="hand" id="playerHand"></div>
        <div class="bet-area" id="betArea"><div class="bet-badge" id="betBadge">$0</div></div>
      </div>

      <!-- Deck / Discard piles -->
      <div class="piles">
        <div>
          <h4>Deck</h4>
          <div class="pile deck"><div class="stack" id="deck"></div></div>
        </div>
        <div>
          <h4>Discard</h4>
          <div class="pile discard"><div class="stack" id="discard"></div></div>
        </div>
      </div>

      <!-- Controls -->
      <div class="controls">
        <button id="btnShuffle">Shuffle</button>
        <button id="btnDeal">Deal</button>
        <button id="btnReset">Reset</button>
        <button id="btnClearBet">Clear Bet</button>
        <button id="btnTheme">Toggle Theme</button>
      </div>

      <div class="note">Core ✅ • 3D ✅ • Burn ✅ • Hover Peek ✅ • Chip Placing ✅</div>
    </div>
  </div>

<script>
/* --- Simple Blackjack Dealer Demo --- */
const SUITS = [
  { sym:'♠', color:'s-black' },
  { sym:'♥', color:'s-red'   },
  { sym:'♣', color:'s-black' },
  { sym:'♦', color:'s-red'   },
];
const RANKS = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];

const deckEl = document.getElementById('deck');
const discardEl = document.getElementById('discard');
const dealerHand = document.getElementById('dealerHand');
const playerHand = document.getElementById('playerHand');
const table = document.getElementById('table');
const betArea = document.getElementById('betArea');
const betBadge = document.getElementById('betBadge');

let deck = [];
let altTheme = false;
let betTotal = 0;

function mkCardEl(card){
  const el = document.createElement('div');
  el.className = 'card face';
  el.dataset.rank = card.rank;
  el.dataset.suit = card.suit.sym;
  el.innerHTML = `
    <span class="rank">${card.rank}</span>
    <span class="suit ${card.suit.color}">${card.suit.sym}</span>
  `;
  return el;
}

function buildDeck(){
  deck = [];
  for (const suit of SUITS){
    for (const rank of RANKS){
      deck.push({rank, suit});
    }
  }
}

function renderDeck(){
  deckEl.innerHTML = '';
  // Stack visuals: render top cards last so they sit above
  const maxShow = 20; // render a visible portion for performance
  const toShow = deck.slice(-maxShow);
  const baseZ = 1000;
  toShow.forEach((card,i) => {
    const el = mkCardEl(card);
    el.style.left = 20 + 'px';
    el.style.top  = (20 - i*0.4) + 'px';
    el.style.zIndex = baseZ + i;
    el.style.transform = `translate(0,0) rotate(${(i%3===0? -1:1)* (1 + (i%5)*.6)}deg) rotateY(-8deg)`;
    deckEl.appendChild(el);
  });
}

function shuffle(){
  // Fisher-Yates
  for (let i = deck.length-1; i>0; i--){
    const j = Math.floor(Math.random()*(i+1));
    [deck[i], deck[j]] = [deck[j], deck[i]];
  }
  // Visual fan animation (Core)
  table.classList.add('shuffling');
  setTimeout(()=> table.classList.remove('shuffling'), 820);
  renderDeck();
}

function burnOne(){
  // Remove top card from deck model and animate a temporary DOM card
  if (deck.length === 0) return;
  const card = deck.pop();
  // Create temp card at deck position and burn it
  const el = mkCardEl(card);
  el.style.left = '20px'; el.style.top='20px';
  el.style.zIndex = 5000;
  el.classList.add('burning');
  deckEl.appendChild(el);
  // After animation, move to discard pile subtly
  setTimeout(()=>{
    el.remove();
    const d = mkCardEl(card);
    d.style.left = (8 + Math.random()*8) + 'px';
    d.style.top = (8 + Math.random()*8) + 'px';
    d.style.transform = `rotate(${(-10 + Math.random()*20)}deg)`;
    d.style.opacity = .85;
    discardEl.appendChild(d);
    renderDeck();
  }, 520);
}

function clearHands(){
  dealerHand.innerHTML = '';
  playerHand.innerHTML = '';
}

function deal(){
  if (deck.length < 4){ buildDeck(); shuffle(); }
  clearHands();

  // Stretch: burn a card first
  burnOne();

  // Compute spot coordinates to animate deal path
  const deckRect = deckEl.getBoundingClientRect();
  const tableRect = table.getBoundingClientRect();
  const fromX = deckRect.left - tableRect.left + 60; // approx deck center
  const fromY = deckRect.top  - tableRect.top  + 40;

  const dealerRect = document.querySelector('.spot.dealer').getBoundingClientRect();
  const playerRect = document.querySelector('#playerHand').getBoundingClientRect();
  const toDealerX = dealerRect.left - tableRect.left + dealerRect.width/2 - 490;
  const toDealerY = dealerRect.top  - tableRect.top  - 45;
  const toPlayerX = playerRect.left - tableRect.left + playerRect.width/2 - 40;
  const toPlayerY = playerRect.top  - tableRect.top  + 5;

  // Sequence: P1, D, P1, D (two each)
  const sequence = [
    {hand:playerHand, dx:toPlayerX, dy:toPlayerY, ry:-6},
    {hand:dealerHand, dx:toDealerX, dy:toDealerY, ry: 6},
    {hand:playerHand, dx:toPlayerX+26, dy:toPlayerY+8, ry:-10},
    {hand:dealerHand, dx:toDealerX+26, dy:toDealerY+8, ry:10},
  ];

  table.classList.add('dealing');

  let delay = 80; // stagger (Core: animation-delay)
  sequence.forEach(step=>{
    // Pop from deck model
    const c = deck.pop();
    const el = mkCardEl(c);
    el.classList.add('fly');
    el.style.setProperty('--sx', `${fromX - step.dx}px`);
    el.style.setProperty('--sy', `${fromY - step.dy}px`);
    el.style.setProperty('--dx', `0px`);
    el.style.setProperty('--dy', `0px`);
    el.style.setProperty('--ry', `${step.ry}deg`);
    el.style.left = step.dx + 'px';
    el.style.top  = step.dy + 'px';
    el.style.zIndex = 4000 + delay;
    el.style.animationDelay = `${delay}ms`;
    step.hand.appendChild(el);
    delay += 220;
  });

  // stop dealing state after last anim
  setTimeout(()=> table.classList.remove('dealing'), delay + 800);
  renderDeck();
}

function resetTable(){
  discardEl.innerHTML = '';
  clearHands();
  buildDeck();
  renderDeck();
  clearBet();
}

function toggleTheme(){
  // Quick theme flip (felt & chips) via CSS variables
  altTheme = !altTheme;
  const root = document.documentElement.style;
  if (altTheme){
    root.setProperty('--felt', '#27406e');
    root.setProperty('--felt-dark', '#1c2d4e');
    root.setProperty('--table-edge', '#3e3555');
    root.setProperty('--chip-red', '#ef6a6a');
    root.setProperty('--chip-blue', '#6aa7ff');
    root.setProperty('--chip-green', '#4bd79a');
    root.setProperty('--chip-gold', '#ffde6a');
  }else{
    root.removeProperty('--felt');
    root.removeProperty('--felt-dark');
    root.removeProperty('--table-edge');
    root.removeProperty('--chip-red');
    root.removeProperty('--chip-blue');
    root.removeProperty('--chip-green');
    root.removeProperty('--chip-gold');
  }
}

/* -------- Betting (click-to-place chips) -------- */
function updateBetBadge(){
  betBadge.textContent = `$${betTotal}`;
}

function clearBet(){
  betTotal = 0;
  updateBetBadge();
  // remove all placed chip elements
  betArea.querySelectorAll('.bet-chip').forEach(e => e.remove());
}

function placeChip(amount, colorClass){
  // Create a chip in the bet area with slight random offset
  const chip = document.createElement('div');
  chip.className = `bet-chip ${colorClass}`;
  chip.textContent = `$${amount}`;

  // Color styling same as tray chips
  const styles = getComputedStyle(document.documentElement);
  let bg = styles.getPropertyValue('--chip-red');
  if (colorClass.includes('blue')) bg = styles.getPropertyValue('--chip-blue');
  if (colorClass.includes('green')) bg = styles.getPropertyValue('--chip-green');
  if (colorClass.includes('gold')) bg = styles.getPropertyValue('--chip-gold');
  chip.style.background = bg;
  if (colorClass.includes('gold')) chip.style.color = '#1a1300';

  // random stack positioning within bet area
  const x = 20 + Math.random()*120;
  const y = 10 + Math.random()*40;
  chip.style.left = x + 'px';
  chip.style.top  = y + 'px';

  // allow removing a chip on click (right-click alternative)
  chip.addEventListener('click', (e)=>{
    e.stopPropagation();
    betTotal -= amount;
    chip.remove();
    updateBetBadge();
  });

  betArea.appendChild(chip);
  betTotal += amount;
  updateBetBadge();
}

/* Init */
resetTable();

/* Events */
document.getElementById('btnShuffle').addEventListener('click', shuffle);
document.getElementById('btnDeal').addEventListener('click', deal);
document.getElementById('btnReset').addEventListener('click', resetTable);
document.getElementById('btnTheme').addEventListener('click', toggleTheme);
document.getElementById('btnClearBet').addEventListener('click', clearBet);

// Chip tray interactions
document.querySelectorAll('.chiptray .chip').forEach(chip => {
  chip.addEventListener('click', ()=>{
    const amount = Number(chip.dataset.val || 0);
    const classes = Array.from(chip.classList).filter(c => ['red','blue','green','gold'].includes(c));
    const colorClass = classes.length ? classes[0] : 'red';
    placeChip(amount, colorClass);
  });
});

/* Responsiveness: future deals compute fresh rects after resize */
window.addEventListener('resize', ()=> {
  // no-op on existing cards; future deals compute fresh rects
});
</script>
</body>
</html>
